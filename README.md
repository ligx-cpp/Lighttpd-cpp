# Lighttpd-cpp


        感谢CSDN上的一位博主：jiange_zh 他的博客给了我很多启发.写在前面 非常感谢！ 
        本程序遇到的一些问题：首先是在我开启多个客户端连接时如果其中一个客户端强制关闭后;相应
的服务器端也会直接退出这个问题 解释如下：当强行关闭客户终端后，client进程交付给初始进程。等初
始进程查询到client后将它杀掉。但是在杀掉之前，由于关掉了终端（主要是关掉了输入缓冲区），导致本
来阻塞中的cin或scanf返回EOF，程序得以继续执行send和recv操作。服务器发现client有消息传入，但是
在尝试回应client的时候client被初始进程杀掉。然后就变成了给已经关闭的socket发送数据。当服务器监
听并接受一个客户端链接的时候, 可以不断向客户端发送数据, 这时如果客户端断开socket链接, 服务器继
续向一个关闭的socket 发送数据(send, write)的时候, 系统会默认对服务器进程发送一个SIGPIPE信号, 这
个信号的默认动作就是终止当前服务器进程。  解决方案:我利用read函数的读取错误返回来的信息,一旦返
回的是错误信息，我就让rwhand对象中的“监听事件循环”退出并且析构掉rwhand对象这样程序就不会出现异
常退出问题
   另一个大问题是如何让我的一个线程同时处理多个连接;现在的情况是我一个线程只能处理一个连接如果当前连接不放开的话就无法收到另一个新套接字的消息;虽然能接收套接字



   做这个项目的初衷(姑且称它为项目)：在做这个小项目之前我也是看了不少书，比如:UNIX环境高级编程 
,linux高性能服务器编程，C++primer 曾经也读过经典的C++live555源码 lighttpd源码 linux操作系统的
简单使用等等还有就不一一列举，我一直秉承着用什么学什么的原则去学习,我知道如果只是去读这些工具
书但不去实践的话，就会很快忘记曾经读过的内容，所以一直就有个想法去做一个“像样”的项目，一方面这
样做会让自己很有成就感，其次是可以巩固所学，所以就在网上找一些别人推荐的项目来做一做，很快就确
定了两个目标:webbench和lighttpd这两个；一个是网站压力测试工具,一个是http轻量级服务器,两个都是
C语言写的;所以就萌生了用面向对象的思想去实现同样功能的东西;最先动手做的是webbench，因为它简单;
我是个半路出家的;和科班出身的人比作东西肯定是差了十万八千里;所以就先从简单的做起。废话太多了。。。


    
   项目大体流程：lighttpd源码是用的watch-worker(监视者-工作者模式)是由一个进程去fork多个子进程
的模式,这里我打算用线程池的方式去代替上述模式;优点是可以减少资源开销,提高响应速度；节省了进程多次
创建和销毁的时间;因为线程池会提前创建线程等待事件的到来。线程池也是从别处学习得来,用到了我的项目当
中,然后我采用的是libevent来实现我的代码(linux高性能服务器编程中有介绍,源码只是大致的浏览过)项目首
先通过在主线程监听客户端的连接然后将连接的套接字传到已经阻塞等待的子线程中进行相应的处理。lighttpd
的核心处理消息机制(状态机)也运用到我的项目当中来:暂时就想到了这么多(后面等项目完成后再补充。。待续)
